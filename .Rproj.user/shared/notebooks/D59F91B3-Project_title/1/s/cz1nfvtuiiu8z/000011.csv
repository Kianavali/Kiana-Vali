"0","# Define top 5 DEGs per cluster"
"0","top5_combined <- DEG_data %>%"
"0","  filter(Cluster %in% c(""Endothelial_cells"", ""Macrophages"", ""T_memory_cells""),"
"0","         ident.1 == ""G2_old"", ident.2 == ""G1_young"","
"0","         !is.na(avg_log2FC), !is.na(p_val_adj),"
"0","         p_val_adj < 0.05,"
"0","         abs(avg_log2FC) > 1,"
"0","         !grepl(""^Gm|^Rik|^ENSMUSG"", gene_symbol)) %>%"
"0","  mutate(score = abs(avg_log2FC) * -log10(p_val_adj),"
"0","         display_gene = ifelse(is.na(gene_symbol) | gene_symbol == """", gene, gene_symbol),"
"0","         direction = case_when("
"0","           avg_log2FC > 1  ~ ""Up (old vs young)"","
"0","           avg_log2FC < -1 ~ ""Down (old vs young)"""
"0","         )) %>%"
"0","  group_by(Cluster, direction) %>%"
"0","  slice_max(order_by = score, n = 5, with_ties = FALSE) %>%"
"0","  ungroup()"
"0",""
"0","# Plot"
"0","ggplot(top5_combined,"
"0","       aes(x = fct_reorder(display_gene, avg_log2FC),"
"0","           y = avg_log2FC,"
"0","           color = direction)) +"
"0","  geom_point(size = 3) +"
"0","  geom_segment(aes(xend = display_gene, y = 0, yend = avg_log2FC),"
"0","               size = 0.6) +"
"0","  facet_wrap(~ Cluster, scales = ""free_y"") +"
"0","  coord_flip() +"
"0","  scale_color_manual(values = c(""Up (old vs young)"" = ""firebrick2"","
"0","                                ""Down (old vs young)"" = ""dodgerblue3"")) +"
"0","  labs(title = ""Top 5 Up & Down DEGs per Cell Type"","
"0","       x = ""Gene"", y = ""log2FC (old vs young)"", color = """") +"
"0","  theme_minimal(base_size = 12) +"
"0","  theme(legend.position = ""top"")"
